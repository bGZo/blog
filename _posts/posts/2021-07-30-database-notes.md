---
layout: post
title: Database Notes
updated: 2021-06-10
category: posts
---

最后靠着 B站 视频复习, 巩固了一遍闭包, 最小依赖集, 范式优化, 通过了期末考试. 推荐给大家应试技巧:

<iframe src="//player.bilibili.com/player.html?aid=456343564&bvid=BV1P5411e7rU&cid=211158985&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

## 大佬

- 1973年 Charles W. Bachman(1924-2017) 网状数据库技术
- 1981年 Edgar F. Codd (1923－2003 )数据库系统，尤其是关系型数据库
- 1998年 Jim Gray (1944-2007.1.28? )数据库与事务处理
- 2014年 Michael Stonebraker(1943-)现代数据库系统底层的概念与实践

## 数据库

- 国外
  - 大型：
    - 甲骨文 Oracle
    - IBM DB2
    - Microsoft SQL Server
    - Sybase 
  - 小型
    - ACCESS
  - 开源
    - PostgresSQL
    - MYSQL
    - berkeley db(BDB)
- 国内
  - 华中科技大学: [DM](http://www.dameng.com/)
  - 中国人民大学: [kingbase](http://www.kingbase.com.cn)
    - 2018年，国家科技进步二等奖
  - 东软: [OpenBASE](http://www.openbase.com.cn)
  - 阿里巴巴: [OceanBase](http://code.taobao.org/p/OceanBase/src/)

## 杂志期刊

| 刊物简称  | 刊物全称                                            | 出版社                | 网址                                                 |
| --------- | --------------------------------------------------- | --------------------- | ---------------------------------------------------- |
| TODS      | ACM Transactions on Database Systems                | ACM                   | http://www.acm.org/tods/                             |
| VLDBJ     | VLDB Journal                                        | Springer- Verlag      | http://www.vldb.org/dblp/db/journals/vldb/index.html |
| TOIS      | ACM Transactions on Information and Systems         | ACM                   | http://www.acm.orgpubs/tois/                         |
| IEEE TKDE | IEEE Transactions on Knowledge and Data Engineering | IEEE Computer Society | http://www.computer.org/tkde/                        |

## 会议

- ACMSIGMOD: 国际计算机学会数据管理专业委员会(ACM SIGMOD)是国际数据库领域最高级别的国际会议。其主要致力于数据库以及信息技术的研究，开发和应用。
- VLDB: 国际超大型数据库会议是一个专门从事超大规模数据库管理理论、方法和应用研究的专业性学术机构，它涉及的内容也很丰富，包括研究及应用的诸多方面，基本上能够较全面地反映当前数据库研究的前沿方向、工业界的最新技术以及各国的研发水平。
- ICDE: 数据工程国际学术会议(ICDE)是由IEEE计算机数据工程技术学会(TCDE)主办的数据库领域的最高级别的国际性会议之一。
- CCFDBS: 中国计算机学会数据库专业委员会(CHINA COMPUTER FEDERATION DATABASE SOCIETY，简称CCFDBS)是中国计算机学会领导下的数据库学术组织。由数据库专业委员会主办的中国数据库学术会议(NDBC)始于1977年，已成为国内数据库领域较为权威的会议。

## 一些必须掌握的概念

一共分 **基础** (绪论, 关系数据库, 关系数据库, 标准语言SQL, 数据库安全性, 数据库完整性), **设计开发** (关系数据理论, 数据库设计, 数据库设计), **系统** (关系查询处理和查询优化, 数据库恢复技术, 并发控制)三大部分. 

- **绪论**
  - 数据: 描述事物的符号记录，是数据库中的基本对象
  - 数据库: 是长期储存在计算机内、有组织的、可共享的大量数据的集合 数据库
  - 数据库管理系统 (DBMS) : 是位于用户与操作系统之间的一层数据管理软件
    - 主要功能:
      - 数据定义功能
      - 数据组织、存储和管理
      - 数据操纵功能: 1.数据的安全性保护；2.数据的完整性检查；3.并发控制；4.数据库恢复
      - 数据库的事务管理和运行管理
      - 数据库的建立和维护
      - 其他功能
  - 数据库系统 (DBS) : 由数据库、数据库管理系统 (及其开发工具) 、应用系统、数据库管理员构成的存储、管理、处理和维护数据的系统. 
  - 人工管理阶段特点
      - 数据不保存
      - 应用程序管理数据
      - 数据不共享
      - 数据不具有独立性
  - 文件系统阶段特点
      - 数据可长期保存
      - 由文件系统管理数据文件
  - 系统缺点
      - 数据共享性差，冗余度大
      - 数据独立性差
  - 数据库系统特点
    - 数据结构化 (与文件系统的本质区别) 
    - 数据的共享性高，冗余度低，易扩充
    - 数据独立性高
    - 数据由DBMS统一管理和控制
  - 独立性:
    - 数据独立性
      - 数据的物理独立性: 指用户的应用程序与存储在磁盘上的数据库中的数据是相互独立的. 
      - 数据的逻辑独立性: 指用户的应用程序与数据库的逻辑结构是相互独立的，即数据的逻辑结构改变了，用户程序也可以不变
  - 数据模型是数据库系统的核心和基础
    - 数据模型的组成要素:
      - 数据结构: 描述数据库的组成对象以及对象之间的联系
      - 数据操作: 指对数据库中各种对象的实例允许执行的操作集合. 
  - 数据库系统的三级模式结构指数据库系统是由外模式、模式和内模式三级构成
      - 模式 (逻辑模式) : 是数据库全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图. 它是数据库系统模式结构的中间层，既不涉及数据的物理存储细节和硬件环境，也与具体的应用程序、所使用的开发工具及高级程序设计语言无关. 一个数据库只有一个模式
    - 外模式 (子模式、用户模式) : 是数据库用户能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示. 通常是模式的子集，一个数据库可以有多个外模式. 外模式是保证数据库安全性的一个有力措施
    - 内模式 (存储模式) : 一个数据库只能有一个内模式，是数据物理结构和存储方式的描述，是数据在数据库内部的表示方式
        外模式/模式映射、模式/内模式映射保证了数据库系统中的数据能够具有较高的逻辑独立性和物理独立性
- **关系数据库**
  - 数据的完整性约束条件: 是指给定的数据模型中数据及其联系所具有的制约和依存规则
  - 实体: 客观存在并可相互区别的事物
  - 属性: 实体所具有的某一特性
  - 码: 唯一标识实体的属性集
  - 域: 属性的取值范围
  - 实体型: 具有相同属性的实体必然具有的特征和性质. 用实体名及其属性名集合来抽象和刻画同类实体，成为实体型
  - 实体集: 同一类型实体的集合
  - 联系: 实体内部的联系通常是指组成实体的各属性之间的联系；实体之间的联系通常是指不同实体集之间的联系. 分为三种
    - 一对一联系
    - 一对多联系
    - 多对多联系
  - 关系模型
    - 关系数据模型的数据结构
    - 操纵和完整性约束
    - 存储结构
  - 关系: 一个关系对应通常说的一张表
  - 元组: 表中的一行即为一个元组
  - 属性: 表中的一列即为一个属性
  - 码 (码键) : 表中的某个属性组，它可以唯一确定一个元组
  - 域: 属性的取值范围
  - 分量: 元组中的一个属性值
  - 候选码: 若关系中的某一属性组的值能唯一的标识一个元组
  - 主码: 若一个关系中有多个候选码，则选定其中一个为主码. 
  - 候选码的诸属性称为主属性. 不包含在任何候选码中的属性称为非主属性或非码属性
  - 关系的三种类型
    - 基本关系 (又称基本表、基表) 
    - 查询表
    - 视图表
  - 关系模型基本操作
    - 查询操作
    - 插入、删除、修改操作
  - 查询操作分为: 选择、投影、连接、除、并、差、交、笛卡尔积 (5种基本操作) 
  - 关系操作特点: 集合操作方式，即操作的对象和结果都是集合，也称一次一集合的方式. 非关系数据模型则是一次一记录的方式
  - 关系数据语言分类:
    - 关系代数语言<sup>[4](#j4)</sup>
      - 集合运算符: 并(union),差(except), 交(intersection)及笛卡尔积(cartesian product)
      - 专门的关系运算符:
        - **选择(select)**: 
          - σ <sub>SAL>1000</sub> (EMP): 取出查询工资大于1000的所有员工的信息
        - **投影(projection)**: ：∏<sub>字段序列</sub>(关系)
          - ∏<sub>ENAME,SAL</sub>(EMP): 查看所有员工的姓名和工资
        - **连接(join)**
          - ∏<sub>ENAME,SAL</sub>(σ<sub>SAL>1000</sub>(EMP)): 求出了所有工资大于1000的员工的名字和工资, 将σ<sub>SAL>1000</sub>(EMP)执行的结果当做一个临时的关系，参与了投影运算得到
            - **自然连接(natural join)**
              - ∏<sub>name, course_id</sub>(instructor ⋈ teaches): 所有老师的名字以及其所授课程的id
        - **除法(division)**
          - 原理解析见[CSDN博客](https://blog.csdn.net/qq_22627687/article/details/53789362)
    - 关系演算语言
    - 具有关系代数和关系演算
- **双重特点的语言 (SQL) **: 用于和DBMS通信的语言
  - 等值连接和自然连接的区别和联系
    - 连接运算符是“=”的连接运算成为等值连接，他是从关系R和S的广义笛卡尔积中选取A、B属性值相等的那些元组
    - 自然连接是一种特殊的等值连接，他要求两个关系中进行比较的分量必须是相同的属性组，并且结果中把重复的属性列去掉
  - SQL集数据查询、数据定义、数据操纵和数据控制功能于一体
  - SQL主要特征包括
    - 综合统一
    - 高度非过程化
    - 面向集合的操作方式
    - 以同一种语法结构提供多种使用方式
    - 语言简洁，易学易用
- **数据库的安全性**
  - 试述实现数据库安全性控制的常用方法和技术:
    - 用户标识和鉴别: 该方法由系统提供一定的方式让用户标识自己的名字或身份. 每次用户要求进入系统时，由系统进行核对，通过鉴定后才提供系统的使用权
    - 存取控制: 通过用户权限定义和合法权检查确保只有合法权限的用户访问数据库，所有未被授权的人员无法存取数
    - 视图机制: 为不同的用户定义视图，通过视图机制把要保密的数据对无权存取的用户隐藏起来，从而自动地对数据提供一定程度的安全保护
    - 审计: 建立审计日志，把用户对数据库的所有操作自动记录下来放入审计日志中，DBA 可以利用审计跟踪的信息，重现导致数据库现有状况的一系列事件，找出非法存取数据的人、时间和内容等
    - 数据加密: 对存储和传输的数据进行加密处理，从而使得不知道解密算法的人无法获知数据的内容. 
  - TCSEC/TDI从 安全策略、责任、保证和文档 来描述安全性级别划分的标准.
  - GRANT语句向用户授予权限，REVOKE语句收回授予的权限
  - 自主存取控制方法: 定义各个用户对不同数据对象的存取权限. 当用户对数据库访问时首先检查用户的存取权限. 防止不合法用户对数据库的存取. 
  - 强制存取控制方法: 每一个数据对象被 (强制地) 标以一定的密级，每一个用户也被 (强制地) 授予某一个级别的许可证. 系统规定只有具有某一许可证级别的用户才能存取某一个密级的数据对象. 
- **数据库的完整性**
  - 数据库完整性是指数据的正确定和相容性
  - 数据库的完整性和安全性的区别和联系
    - 数据库的完整性是为了防止数据库存在不符合语义的数据，也就是防止数据库中存在不正确的数据. 完整性检查和控制的防范对象是不合语义的、不正确的数据，防止它们进入数据库. 
    - 数据的安全性是指保护数据库以防止不合法的使用所造成的数据泄露、更改或破坏. 安全性控制的防范对象是非法用户和非法操作，防止他们对数据库数据的非法存取. 
  - 为维护数据库的完整性，DBMS必须能够
    - 提供定义完整性约束条件的机制
    - 提供完整性检查的方法
    - 违约处理
  - 关系的完整性约束条件包括
    - 实体完整性: 若属性 (指一个或一组属性) A是基本关系R的主属性，则A不能取空值
    - 参照完整性: 若属性 (或属性组) F是基本关系R的外码，它与基本关系S的主码Ks相对应 (基本关系R和S不一定是不同的关系) ，则对于R中每个元组在F上的值必须为: 1.或者取空值 (F的每个属性值均为空值) ；2.或者等于S中某个元组的主码值
    - 用户定义的完整性
  - 关系的两个不变性: 实体完整性和参照完整性的关系模型必须满足的完整性约束条件
- **关系数据理论**
  - 关系模式存在的问题
    - 数据容易太大
    - 更新异常
    - 插入异常
    - 删除异常
  - 函数依赖: 设R(U)是属性集U上的关系模式. X,Y是U的自己. 若对于R(U)的任意一个可能的关系r，r中不可能存在两个元组在X上的属性值相等，而在Y上的属性值不相等，则称X函数确定Y或Y函数依赖于X，记作X→Y
  - 规范化: 一个低一级范式的关系模式，通过模式分解可以转换为若干个高一级范式的关系模式的集合，这种过程就叫做规范化
    - 1NF: 每一个分量必须是不可分的数据项， 满足了这个最低要求的关系模式就属于1NF
    - 2NF: 若R∈1NF，且每一个非主属性完全函数依赖于码，则R∈2NF
    - 3NF: 关系模式R<U,F>中若不存在这样的码X，属性组Y及非主属性Z (Z不是Y的真子集) 使得X→Y，Y→Z成立，Y\→Z，则称R<U,F>∈3NF
    - BCNF: 关系模式R<U,F>∈1NF.若X→Y且Y不是X真子集时X必含有码，则R<U,F>∈BCNF 一个关系模式R不属于2NF，就会产生以下问题: 1.插入异常；2.删除异常；3.修改异常 模式分解的3个定义: 分解具有“无损连接性”；分解要“保持函数依赖”；分解既要“保持函数依赖”，优雅具有“无损连接性”
    - ......
- **数据库设计**
  - 数据库设计的一般定义: 对于一个给定的应用环境，构造 (设计) 优化的数据库逻辑模式和物理结构，并据此建立数据库及应用系统，使之能够有效的存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求
    - 信息管理要求: 在数据库中应该存储和管理哪些数据对象
    - 数据操作要求: 对数据对象e需要进行哪些操作，如查询、增、删、改、统计等操作数据库设计目标，为用户和各应用系统提供一个信息基础设施和高效率的运行环境
      - 高效率的运行环境包括: 数据库数据的存取效率、数据库存储空间的利用率、数据库系统运行管理的效率等都是高的
  - 数据可设计的特点: 1.数据库设计的基本规律: “三分技术，七分管理，十二分基础数据”；2.结构 (数据) 设计和行为 (处理) 设计相结合
  - 概念结构的主要特点
    - 能真实、充分地反映现实世界，包括事物和事物之间的联系，能满足用户对数据的粗粒要求，是实现世界的一个真实模型
    - 易于理解，从而可以用它和不熟悉计算机的用户交换意见，用户积极的参与是数据库设计成功的关键
    - 易于更改，当应用环境和应用要求改变时，容易对概念模型修改和扩充
    - 易于向关系、网状、层次等各种数据模型转换
- **查询处理与查询优化**
  - 查询优化的优点不仅在于用户不必考虑如何最好的表达查询以获得较好的效率，而且在于系统可以比用户程序的“优化”做得更好
  - 查询优化的总目标: 选择有效的策略，求得给定关系表达式的值，使得查询代价最小
  - 代数优化策略是通过对关系代数表达式的等价变化来提高查询效率 物理优化就是
  - 要选择高效合理的操作算法或存取路径，求得优化的查询计划，达到查询优化的目标
- **数据库恢复技术**
  - 事务是用户定义的一个数据库操作序列，这些操作要么全做要么全部做，是一个不可分割的工作单位
  - 事务通常以BEGIN TRANSACTION开始，以COMMIT或ROLLBACK结束. COMMIT表示提交，提交事务的所有操作ROLLBACK表示回滚，即在事务运行过程中发生了某种故障，事务不能继续执行，系统将事务中对数据库的所有已完成的操作全部撤销，回滚到事务开始时的态
  - 事务的四个特性 (ACID特性) : 原子性、一致性、隔离性、持续性
    - 原子性: 事务是数据库的逻辑工作单位，事务中包括的诸操作要么都做，要么都不做
    - 一致性: 事务执行的结果必须是使数据库从一个一致性状态变换到另一个一致性状态
    - 隔离性: 对并发执行而言，一个事务的执行不能被其他事务干扰
    - 持续性: 一个事务一旦提交，它对数据库中数据的改变就应该是永久性的
  - **故障的种类及恢复策略**
  - 事务故障
      - 反向扫描文件日志，查找该事务的更新操作
      - 对该事务的更新操作执行逆操作
      - 继续反向扫描日志文件，做同样处理
      - 如此处理下去，直至读到此事务的开始标记，该事务故障的恢复就完成了
    - 系统故障 (软故障) 
      - 正向扫描日志文件，找出在故障发生前已经提交的事务队列和未完成的事务队列
      - 对撤销队列中的各个事务进行撤销处理
      - 对重做队列中的各个事务进行重做处理
    - 介质故障 (硬) : 最严重的一种故障. 恢复方法是重装数据库，然后重做已完成的事务. 
      - 装入最新的数据库后备副本 (离故障发生时刻最近的转储副本) , 使数据库恢复到转储时的一致性状态
      - 装入转储结束时刻的日志文件副本，重做已完成的事务. 
    - 计算机病毒
  - 数据库恢复的基本技术: 数据转储 及 登陆日志文件
    - 当系统运行过程中发生故障，利用转储的数据库后备副本和日志文件就可以将数据库恢复到故障前某个一致性状态. 
  - 检查点记录是一类新的日志记录. 
    - 建立检查点时刻所有正在执行的事务清单
    - 这些事务的最近一个日志记录的地址
  - 建立冗余数据最常用的技术
    - 数据转储
    - 登记日志文件
  - 并发操作带来的数据的不一致问题: 丢失修改、不可重复读、读“脏”数据
  - 避免死锁的简单方法是采用先来先服务的策略
  - 三级封锁协议
    - 一级封锁协议: 写数据前加写锁，读数据不加锁. 只能防止丢失修改. 
    - 二级封锁协议: 在一级封锁协议上，读取数据需要加读锁，读完就释放. 避免读脏数据. 
    - 三级封锁协议: 一级封锁协议上，读数据加读锁，事务结束再释放. 

## SQL 实验

学校实验环境用的 `Oracle 11g`, 话说这个版本真的是原罪, 使用的人很少, 尽管已经在 Stackoverflow 上找到了安装教程, 但是我的 Ubuntu 还是尽出 Bug, 最后又卸载Ubuntu(丢了很多宝贵的数据), 跳回 Windows 了, 就是为了用这个实验软件, 为什么学校不用最新的 Oracle 而是用了这个旧版本呢? 确实郁闷.

我把一个学期的实验作业以及实验笔记托管在了 [Gist](https://gist.github.com/bGZoCg/cc81fcceb8455e95a413a20cd0759cb7). IMU 的校友可以自行翻阅.

<script src="https://gist.github.com/bGZoCg/cc81fcceb8455e95a413a20cd0759cb7.js"></script>

## Postgresql 源码分析

如果我可以预先知道后面的章节，所有工作都会比现在更好. 在读源码的过程中, VSCode的扩展 `Comment Translate` 帮助了我很多. PostgreSQL的源码很棒，所有模型都充满了注释. PostgreSQL 总流程和 Oracle 是相同的, 所以这里之说说差异细节.

正如我们知道的，流程就像 `Parser -(tree)> Rewriter -(convert)> Planner -(review)> Executor(do)`. 首先，解析器在 `./src/backend/parser/scan.l` 路径下使用 [flex](http://www.cs.virginia.edu/~cr4bd/flex-manual), 在 `/ src / backend / parser / gram.y` 下使用 bison.

如果您着迷于这一结构，您也可以阅读 <<*postgreSQL数据库核心分析*>>。 它的豆瓣页面是[这里](https://book.douban.com/subject/6971366/)

## Ubuntu 折腾记录

- 下载
  - [Oracle Database Express Edition (XE) Release 11.2.0.2.0 (11gR2)](https://www.oracle.com/database/technologies/xe-prior-releases.html)
  - [Oracle Database Software Downloads](https://www.oracle.com/database/technologies/oracle-database-software-downloads.html)
- 安装<sup>[1](#j1)[2](#j2)[3](#j3)</sup>
    ```shell
    $ sudo apt install rmp -y && sudo apt install alien -y
    $ sudo alien --scripts -d oracle-xe-11.2.0-1.0.x86_64.rpm
    $ sudo dpkg -i oracle-xe_11.2.0-2_amd64.deb
    # /var/lib/dpkg/info/oracle-xe.postinst: line 114: /sbin/chkconfig: No such file or directory You must run '/etc/init.d/oracle-xe configure' as the root user to configure the database.
    $ sudo /etc/init.d/oracle-xe configure
    # 安装的时候一大堆目录错过了...
    $ reboot
    ```

## 拓展

- [X分钟速成Y-SQL](https://learnxinyminutes.com/docs/zh-cn/sql/)
- [MySQL_基础+高级篇- 数据库 -sql -mysql教程_mysql视频_mysql入门_尚硅谷](https://www.bilibili.com/video/BV12b411K7Zu). 
- [尚硅谷MySQL核心技术基础知识笔记](https://www.jianshu.com/p/91856df6b6f9)

<br/>


<div id="j1">[1]. https://askubuntu.com/posts/983032/edit</div>
<div id="j2">[2]. https://dba.stackexchange.com/questions/13291/installing-oracle-11g-on-ubuntu-11-10</div>
<div id="j3">[3]. https://docs.oracle.com/cd/E17781_01/install.112/e18802/toc.htm#XEINL123</div>
<div id="j3">[3]. https://www.jianshu.com/p/f7f9440e30a5</div>
